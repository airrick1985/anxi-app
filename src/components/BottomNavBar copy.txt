<template>
  <div class="bottom-nav-wrapper">
    <v-bottom-navigation
      app
      color="white"
      grow
      height="65"
      class="bottom-nav-float"
      elevation="12"
    >
      <v-btn
        :class="{ 'active-btn': isActive('/home') }"
        stacked
        :ripple="true"
        @click="handleHomeClick"
      >
        <v-icon>mdi-home</v-icon>
        é¦–é 
      </v-btn>

      <v-btn
        :class="{ 'active-btn': isActive('/inspection-record') }"
        stacked
        :ripple="true"
        @click="navigate('/inspection-record')"
      >
        <v-icon>mdi-clipboard-text</v-icon>
        æŸ¥çœ‹æˆ¶åˆ¥
      </v-btn>

      <v-btn
        :class="{ 'active-btn': isActive('/inspection-overview') }"
        stacked
        :ripple="true"
        @click="navigate('/inspection-overview')"
      >
        <v-icon>mdi-file-document-multiple</v-icon>
        é©—å±‹ç¸½è¦½
      </v-btn>
    </v-bottom-navigation>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { useRouter, useRoute } from 'vue-router';
import { useRegisterSW } from 'virtual:pwa-register/vue';

const router = useRouter();
const route = useRoute();
const { updateServiceWorker } = useRegisterSW({ immediate: true });

// === é»æ“Š Home 5æ¬¡å¿«é€Ÿæ›´æ–° ===
const homeClickCount = ref(0);
let clickTimer = null;

const handleHomeClick = () => {
  homeClickCount.value++;

  if (homeClickCount.value >= 5) {
    console.log('ğŸ”„ è§¸ç™¼å¼·åˆ¶æ›´æ–°');
    updateServiceWorker(true).then(() => {
      window.location.reload();
    });
    homeClickCount.value = 0;
    clearTimeout(clickTimer);
  } else {
    if (route.path !== '/home') {
      router.push('/home');
    }
    if (clickTimer) clearTimeout(clickTimer);
    clickTimer = setTimeout(() => {
      homeClickCount.value = 0;
    }, 3000);
  }
};

// === é€šç”¨è·³é 
const navigate = (path) => {
  if (route.path !== path) {
    router.push(path);
  } else {
    // å¦‚æœå·²åœ¨è©²é ï¼ŒåŸ·è¡Œå°å½ˆè·³å‹•ç•«
    const navBtn = document.querySelector(`a[href='${path}']`)?.parentElement;
    if (navBtn) {
      navBtn.classList.add('bounce');
      setTimeout(() => navBtn.classList.remove('bounce'), 400);
    }
  }
};

// === åˆ¤æ–·é«˜äº®
const isActive = (path) => route.path === path;
</script>

<style scoped>
.bottom-nav-wrapper {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 95%;
  max-width: 500px;
  z-index: 99;
}

.bottom-nav-float {
  border-radius: 20px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  overflow: hidden;
}

/* ç•¶å‰é é¢é«˜äº® */
.active-btn {
  color: #1976d2 !important; /* ä¸»é¡Œè‰² */
}

/* å½ˆè·³å‹•ç•« */
@keyframes bounce {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}
.bounce {
  animation: bounce 0.4s ease;
}
</style>
